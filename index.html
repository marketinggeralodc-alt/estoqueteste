<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Pedidos OdontoCompany (Online)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        .page { display: none; }
        .status-pendente { background-color: #fef9c3; border-left-color: #facc15; }
        .status-aprovado { background-color: #dcfce7; border-left-color: #22c55e; }
        .status-rejeitado { background-color: #fee2e2; border-left-color: #ef4444; }
        
        /* IMPRESSÃO OTIMIZADA E LIMPA */
        @media print {
            body > * { display: none !important; }
            #print-area, #print-area * { display: block !important; visibility: visible !important; }
            #print-area { 
                position: absolute; 
                left: 0; 
                top: 0; 
                width: 100%; 
                color: #000; 
                background: white;
                padding: 10px;
            }
            .print-header { 
                text-align: center; 
                border-bottom: 2px solid #000; 
                margin-bottom: 10px; 
                padding-bottom: 5px;
            }
            .print-title { font-size: 18px; font-weight: bold; text-transform: uppercase; }
            .print-meta { font-size: 12px; color: #333; }
            
            /* Grid para economizar papel */
            .print-grid {
                display: grid;
                grid-template-columns: 1fr 1fr; /* Duas colunas */
                gap: 5px 20px;
                font-size: 11px; /* Fonte menor */
            }
            .print-item {
                display: flex;
                justify-content: space-between;
                border-bottom: 1px dashed #ccc;
                padding: 2px 0;
            }
            .print-item span:first-child { font-weight: 500; }
            .print-item span:last-child { font-weight: bold; }
            
            .print-extras {
                margin-top: 15px;
                border: 1px solid #999;
                padding: 5px;
                font-size: 11px;
            }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen pb-10">

    <div id="app" class="w-full">
        <div id="page-select-filial" class="page flex flex-col items-center justify-center min-h-screen p-4">
            <div class="w-full max-w-md bg-white rounded-lg shadow-xl p-6 md:p-8">
                <div class="flex justify-center mb-6">
                    <svg class="h-16 w-16 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-1 4h1m4-8h1m-1 4h1m-1 4h1" />
                    </svg>
                </div>
                <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-800 mb-6">Controle de Pedidos</h1>
                <p class="text-center text-xs text-green-600 mb-4 font-bold flex items-center justify-center gap-2 bg-green-50 py-1 rounded">
                    <i data-lucide="cloud" class="w-3 h-3"></i> Sistema Online
                </p>
                <div class="space-y-3">
                    <button onclick="goToLogin('Patos de Minas')" class="w-full flex justify-between items-center text-lg text-gray-700 bg-gray-50 hover:bg-blue-50 border border-gray-200 hover:border-blue-500 py-3 px-4 rounded-lg font-semibold transition-all group">
                        <span>Patos de Minas</span>
                        <i data-lucide="chevron-right" class="text-gray-400 group-hover:text-blue-500"></i>
                    </button>
                    <button onclick="goToLogin('São Gotardo')" class="w-full flex justify-between items-center text-lg text-gray-700 bg-gray-50 hover:bg-blue-50 border border-gray-200 hover:border-blue-500 py-3 px-4 rounded-lg font-semibold transition-all group">
                        <span>São Gotardo</span>
                        <i data-lucide="chevron-right" class="text-gray-400 group-hover:text-blue-500"></i>
                    </button>
                    <button onclick="goToLogin('Ibiá')" class="w-full flex justify-between items-center text-lg text-gray-700 bg-gray-50 hover:bg-blue-50 border border-gray-200 hover:border-blue-500 py-3 px-4 rounded-lg font-semibold transition-all group">
                        <span>Ibiá</span>
                        <i data-lucide="chevron-right" class="text-gray-400 group-hover:text-blue-500"></i>
                    </button>
                    <button onclick="goToLogin('Guarda dos Ferreiros')" class="w-full flex justify-between items-center text-lg text-gray-700 bg-gray-50 hover:bg-blue-50 border border-gray-200 hover:border-blue-500 py-3 px-4 rounded-lg font-semibold transition-all group">
                        <span>Guarda dos Ferreiros</span>
                        <i data-lucide="chevron-right" class="text-gray-400 group-hover:text-blue-500"></i>
                    </button>
                </div>
                <div class="text-center mt-8 pt-4 border-t">
                    <a href="#" onclick="goToAdminLogin()" class="text-sm text-gray-400 hover:text-blue-600 flex items-center justify-center gap-1">
                        <i data-lucide="lock" class="w-3 h-3"></i> Área Administrativa
                    </a>
                </div>
            </div>
        </div>

        <div id="page-login" class="page flex flex-col items-center justify-center min-h-screen p-4">
            <div class="w-full max-w-sm bg-white rounded-lg shadow-xl p-8">
                <button onclick="logout()" class="text-gray-500 hover:text-blue-600 mb-4 flex items-center text-sm"><i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i> Voltar</button>
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i data-lucide="user" class="w-8 h-8 text-blue-600"></i>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800">Login</h2>
                    <p class="text-blue-600 font-medium" id="login-filial-name">...</p>
                </div>
                <input type="password" id="filial-password" placeholder="Digite a senha" class="w-full border border-gray-300 rounded-lg p-3 text-center text-lg mb-4 focus:ring-2 focus:ring-blue-500 outline-none">
                <button onclick="handleFilialLogin()" class="w-full text-lg text-white bg-blue-600 hover:bg-blue-700 py-3 px-4 rounded-lg font-bold shadow-md transition-colors">Entrar</button>
            </div>
        </div>
        
        <div id="page-admin-login" class="page flex flex-col items-center justify-center min-h-screen p-4">
            <div class="w-full max-w-sm bg-white rounded-lg shadow-xl p-8 border-t-4 border-red-500">
                <button onclick="logout()" class="text-gray-500 hover:text-blue-600 mb-4 flex items-center text-sm"><i data-lucide="arrow-left" class="w-4 h-4 mr-1"></i> Voltar</button>
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i data-lucide="shield" class="w-8 h-8 text-red-600"></i>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800">Administrador</h2>
                </div>
                <input type="password" id="admin-password" placeholder="Senha Mestre" class="w-full border border-gray-300 rounded-lg p-3 text-center text-lg mb-4 focus:ring-2 focus:ring-red-500 outline-none">
                <button onclick="handleAdminLogin()" class="w-full text-lg text-white bg-red-600 hover:bg-red-700 py-3 px-4 rounded-lg font-bold shadow-md transition-colors">Acessar Painel</button>
            </div>
        </div>

        <div id="page-menu" class="page container mx-auto p-4 md:p-8 max-w-4xl">
            <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4 bg-white p-4 rounded-xl shadow-sm">
                <div>
                    <p class="text-sm text-gray-500">Bem-vindo(a),</p>
                    <h1 class="text-2xl font-bold text-blue-600" id="menu-filial-name">Filial</h1>
                </div>
                <button onclick="logout()" class="text-red-500 hover:text-red-700 font-semibold py-2 px-4 rounded-lg border border-red-100 hover:bg-red-50 flex items-center gap-2">
                    <i data-lucide="log-out" class="w-4 h-4"></i> Sair
                </button>
            </header>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div onclick="goToPage('page-manage-stock')" class="bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer hover:shadow-lg hover:border-blue-300 border border-transparent transition-all">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4">
                        <i data-lucide="package" class="h-8 w-8 text-blue-600"></i>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800 mb-1">Meu Estoque</h2>
                    <p class="text-sm text-gray-500 mb-4">Atualize a contagem e mínimos.</p>
                    <button class="w-full text-blue-600 font-semibold bg-blue-50 py-2 rounded-lg">Acessar</button>
                </div>

                <div onclick="goToPage('page-order-form')" class="bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer hover:shadow-lg hover:border-green-300 border border-transparent transition-all">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
                        <i data-lucide="shopping-cart" class="h-8 w-8 text-green-600"></i>
                    </div>
                    <h2 class="text-xl font-bold text-gray-800 mb-1">Novo Pedido</h2>
                    <p class="text-sm text-gray-500 mb-4">Gere pedidos automáticos.</p>
                    <button class="w-full text-green-600 font-semibold bg-green-50 py-2 rounded-lg">Acessar</button>
                </div>

                <div onclick="renderClinicHistory()" class="bg-white rounded-xl shadow-md p-6 flex flex-col items-center text-center cursor-pointer hover:shadow-lg hover:border-purple-300 border border-transparent transition-all md:col-span-2">
                    <div class="flex items-center gap-4 mb-2">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <i data-lucide="history" class="h-6 w-6 text-purple-600"></i>
                        </div>
                        <div class="text-left">
                            <h2 class="text-xl font-bold text-gray-800">Meus Pedidos</h2>
                            <p class="text-sm text-gray-500">Veja o status dos envios anteriores.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-manage-stock" class="page container mx-auto p-4 max-w-6xl">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="goToPage('page-menu')" class="p-2 bg-white rounded-full shadow text-gray-600 hover:text-blue-600"><i data-lucide="arrow-left" class="w-5 h-5"></i></button>
                <h1 class="text-xl md:text-2xl font-bold text-gray-800">Estoque</h1>
            </div>
            
            <div class="bg-white p-4 rounded-xl shadow-sm mb-4 flex flex-col md:flex-row gap-3">
                <div class="relative flex-1">
                    <i data-lucide="search" class="absolute left-3 top-3 text-gray-400 w-5 h-5"></i>
                    <input type="text" id="stock-search" onkeyup="filterTable('stock-search', 'stock-table-body')" placeholder="Buscar produto..." class="w-full pl-10 p-2 border rounded-lg">
                </div>
                
                <button onclick="unlockMinimums()" id="btn-unlock" class="bg-gray-200 text-gray-600 px-4 py-2 rounded-lg font-medium flex items-center justify-center gap-2 shadow-sm hover:bg-gray-300 transition-colors" title="Destravar Mínimos">
                    <i data-lucide="lock" class="w-4 h-4"></i> <span class="hidden md:inline">Mínimos</span>
                </button>

                <button onclick="openAddProductModal()" class="bg-green-600 text-white px-4 py-2 rounded-lg font-medium flex items-center justify-center gap-2 shadow-sm hover:bg-green-700">
                    <i data-lucide="plus" class="w-4 h-4"></i> Novo
                </button>
                <button onclick="saveStock()" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium flex items-center justify-center gap-2 shadow-sm hover:bg-blue-700">
                    <i data-lucide="save" class="w-4 h-4"></i> Salvar Nuvem
                </button>
            </div>

            <div class="overflow-x-auto bg-white rounded-xl shadow-sm border border-gray-100 max-h-[65vh]">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-gray-50 sticky top-0 z-10">
                        <tr>
                            <th class="px-4 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider">Produto</th>
                            <th class="px-2 py-3 text-center text-xs font-bold text-gray-500 uppercase w-20">Mín</th>
                            <th class="px-2 py-3 text-center text-xs font-bold text-gray-500 uppercase w-20">Atual</th>
                            <th class="px-2 py-3 text-center w-10"></th>
                        </tr>
                    </thead>
                    <tbody id="stock-table-body" class="divide-y divide-gray-100"></tbody>
                </table>
            </div>
        </div>

        <div id="page-order-form" class="page container mx-auto p-4 max-w-6xl">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="goToPage('page-menu')" class="p-2 bg-white rounded-full shadow text-gray-600 hover:text-blue-600"><i data-lucide="arrow-left" class="w-5 h-5"></i></button>
                <h1 class="text-xl md:text-2xl font-bold text-gray-800">Novo Pedido</h1>
            </div>
            
            <div class="bg-white p-4 rounded-xl shadow-sm mb-4 relative">
                <i data-lucide="search" class="absolute left-6 top-6 text-gray-400 w-5 h-5"></i>
                <input type="text" id="order-search" onkeyup="filterTable('order-search', 'order-table-body')" placeholder="Filtrar produtos..." class="w-full pl-10 p-2 border rounded-lg">
            </div>

            <div class="overflow-x-auto bg-white rounded-xl shadow-sm border border-gray-100 max-h-[50vh] mb-6">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-gray-50 sticky top-0 z-10">
                        <tr>
                            <th class="px-4 py-3 text-xs font-bold text-gray-500 uppercase tracking-wider">Produto</th>
                            <th class="px-2 py-3 text-center text-xs font-bold text-gray-500 uppercase w-16">Mín</th>
                            <th class="px-2 py-3 text-center text-xs font-bold text-gray-500 uppercase w-16">Est.</th>
                            <th class="px-2 py-3 text-center text-xs font-bold text-red-500 uppercase w-16">Sug.</th>
                            <th class="px-4 py-3 text-center text-xs font-bold text-green-600 uppercase w-24">Qtd</th>
                        </tr>
                    </thead>
                    <tbody id="order-table-body" class="divide-y divide-gray-100"></tbody>
                </table>
            </div>

            <div class="bg-white rounded-xl shadow-sm p-4 mb-6 border border-gray-100">
                <label class="block text-sm font-medium text-gray-700 mb-2">Observações / Extras</label>
                <textarea id="extra-items-textarea" rows="3" class="w-full border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Digite aqui itens que não estão na lista..."></textarea>
            </div>

            <button onclick="reviewOrder()" class="w-full bg-blue-600 hover:bg-blue-700 text-white text-lg font-bold py-4 rounded-xl shadow-lg transition-transform active:scale-95 flex justify-center items-center gap-2">
                Revisar Pedido <i data-lucide="arrow-right" class="w-5 h-5"></i>
            </button>
        </div>

        <div id="page-review-order" class="page container mx-auto p-4 max-w-3xl">
            <button onclick="goToPage('page-order-form')" class="mb-6 text-gray-600 hover:text-blue-600 font-semibold flex items-center gap-1"><i data-lucide="arrow-left" class="w-4 h-4"></i> Voltar e Editar</button>
            
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="bg-gray-50 p-6 border-b text-center">
                    <h1 class="text-2xl font-bold text-gray-800">Resumo do Pedido</h1>
                    <p class="text-gray-500 text-sm">Confira os itens antes de enviar</p>
                </div>
                <div id="review-summary-container" class="p-6"></div>
                <div class="p-6 bg-gray-50 border-t flex flex-col md:flex-row gap-4">
                    <button onclick="printOrder(currentOrder, currentExtraItems)" class="flex-1 bg-white border border-gray-300 text-gray-700 font-bold py-3 rounded-lg hover:bg-gray-50 flex justify-center items-center gap-2">
                        <i data-lucide="printer" class="w-5 h-5"></i> Imprimir Rascunho
                    </button>
                    <button onclick="submitOrder()" class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg shadow-md flex justify-center items-center gap-2">
                        <i data-lucide="send" class="w-5 h-5"></i> Confirmar Envio
                    </button>
                </div>
            </div>
        </div>
        
        <div id="page-history-clinic" class="page container mx-auto p-4 max-w-5xl">
            <div class="flex items-center gap-4 mb-6">
                <button onclick="goToPage('page-menu')" class="p-2 bg-white rounded-full shadow text-gray-600 hover:text-blue-600"><i data-lucide="arrow-left" class="w-5 h-5"></i></button>
                <h1 class="text-xl md:text-2xl font-bold text-gray-800">Histórico de Pedidos</h1>
            </div>
            <div id="clinic-history-list" class="space-y-4"></div>
        </div>

        <div id="page-admin-panel" class="page container mx-auto p-4 max-w-6xl">
            <header class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4 bg-white p-6 rounded-xl shadow-sm border border-red-100">
                <div class="flex items-center gap-4">
                    <div class="bg-red-50 p-3 rounded-lg"><i data-lucide="shield" class="w-6 h-6 text-red-600"></i></div>
                    <div>
                        <h1 class="text-2xl font-bold text-red-600">Painel Admin</h1>
                        <p class="text-gray-500 text-sm">Monitoramento em Tempo Real</p>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button onclick="refreshAdminPanel()" class="text-blue-600 bg-blue-50 hover:bg-blue-100 font-semibold px-4 py-2 rounded-lg flex items-center gap-2 transition-colors">
                         <i data-lucide="refresh-cw" class="w-4 h-4"></i> Atualizar
                    </button>
                    <button onclick="logout()" class="text-gray-600 border border-gray-300 hover:border-red-300 hover:text-red-600 font-semibold px-4 py-2 rounded-lg transition-colors">Sair</button>
                </div>
            </header>
            
            <div id="admin-list-container" class="space-y-6"></div>
            <p id="no-pending-orders" class="text-center text-gray-400 py-12 hidden italic">Nenhum pedido pendente no momento.</p>
        </div>

    </div>

    <div id="loading-overlay" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-[9999]">
        <div class="bg-white p-6 rounded-xl shadow-2xl flex flex-col items-center">
            <div class="animate-spin rounded-full h-10 w-10 border-4 border-blue-600 border-t-transparent mb-4"></div>
            <div class="text-gray-800 font-bold">Processando...</div>
        </div>
    </div>
    
    <div id="alert-box" class="fixed top-6 right-6 bg-gray-800 text-white px-6 py-4 rounded-xl shadow-2xl hidden z-[10000] flex items-center gap-3">
        <i data-lucide="info" class="w-5 h-5 text-blue-400"></i>
        <span id="alert-message"></span>
    </div>
    
    <div id="print-area" class="hidden"></div>
    
    <div id="modal-add-product" class="fixed inset-0 bg-black/60 flex items-center justify-center p-4 hidden z-[9990]">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6">
            <h2 class="text-xl font-bold mb-4 text-gray-800">Novo Produto</h2>
            <div class="space-y-3">
                <input type="text" id="new-prod-desc" placeholder="Nome do Produto" class="w-full border p-3 rounded-lg outline-none focus:border-blue-500">
                <input type="text" id="new-prod-cat" placeholder="Categoria (Ex: Dentística)" class="w-full border p-3 rounded-lg outline-none focus:border-blue-500">
                <input type="text" id="new-prod-marca" placeholder="Marca" class="w-full border p-3 rounded-lg outline-none focus:border-blue-500">
            </div>
            <div class="flex justify-end gap-3 mt-6">
                <button onclick="closeAddProductModal()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg">Cancelar</button>
                <button onclick="addNewProduct()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium">Adicionar</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getFirestore, collection, doc, getDoc, setDoc, addDoc, getDocs, updateDoc, query, where, orderBy } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        // --- CONFIGURAÇÃO ---
        const firebaseConfig = {
            apiKey: "AIzaSyACXxrJYZmIgBK65t-aAL8wa7wNsQxRuCE",
            authDomain: "odonto-teste-71e4c.firebaseapp.com",
            projectId: "odonto-teste-71e4c",
            storageBucket: "odonto-teste-71e4c.firebasestorage.app",
            messagingSenderId: "198684123468",
            appId: "1:198684123468:web:849033310014d7e5146fe9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- VARIÁVEIS ---
        window.selectedFilial = localStorage.getItem('lastFilial') || null; 
        let filialInventory = {};
        window.currentOrder = {};
        window.currentExtraItems = "";
        let minUnlocked = false; // ESTADO: Controla se os mínimos podem ser editados
        
        const FILIAL_PASSWORDS = { 'Patos de Minas': '123', 'São Gotardo': '123', 'Ibiá': '123', 'Guarda dos Ferreiros': '123' };
        const ADMIN_PASSWORD = 'admin123';
        const MASTER_PASSWORD = 'master'; // SENHA PARA ALTERAR MÍNIMOS

        // CATÁLOGO
        const INITIAL_CATALOG = {
            "AGULHA CURTA": { cat: "CIRURGIA", marca: "ALLPRIME", min: 2 },
            "AGULHA LONGA": { cat: "CIRURGIA", marca: "ALLPRIME", min: 1 },
            "ALPHACAINA": { cat: "CIRURGIA", marca: "DFL", min: 4 },
            "ANESTÉSICO ARTICAINE": { cat: "CIRURGIA", marca: "DFL", min: 3 },
            "BENSONTOP": { cat: "CIRURGIA", marca: "DFL", min: 3 },
            "FIO DE SUTURA 3-0 NLON": { cat: "CIRURGIA", marca: "PROCARE", min: 4 },
            "FIO DE SUTURA 4-0 NYLON": { cat: "CIRURGIA", marca: "PROCARE", min: 2 },
            "HEMOLIQ": { cat: "CIRURGIA", marca: "MAQUIRA", min: 2 },
            "HEMOSPON - ESPONJA HEMOSTÁTICA": { cat: "CIRURGIA", marca: "MAQUIRA", min: 4 },
            "LÂMINA DE BISTURI Nº12": { cat: "CIRURGIA", marca: "SOLIDOR", min: 2 },
            "LÂMINA DE BISTURI Nº15": { cat: "CIRURGIA", marca: "SOLIDOR", min: 3 },
            "LUVA CIRURGICA 7,5": { cat: "CIRURGIA", marca: "DESCARPAK", min: 20 },
            "LUVA CIRURGICA ESTÉRIL 6,5": { cat: "CIRURGIA", marca: "DESCARPAK", min: 30 },
            "MEPVACAINE S/ VASO CONSTRICTOR": { cat: "CIRURGIA", marca: "DFL", min: 1 },
            "PLACA MOLDEIRA 1MM": { cat: "CIRURGIA", marca: "VILLEVIE", min: 4 },
            "SUGADOR CIRURGICO (CAIXA)": { cat: "CIRURGIA", marca: "MAQUIRA", min: 3 },
            "PASTA DE POLIMENTO DIAMOND": { cat: "DENTÍSTICA", marca: "FGM", min: 1 },
            "Resina FORMA A 2d": { cat: "DENTÍSTICA", marca: "ULTRADENT", min: 1 },
            "Resina Z250 - 3,5": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 1 },
            "Resina Z250 - B1": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 1 },
            "SISTEMA ADESIVO AUTOCOND. TAMPA VERMELHA": { cat: "DENTÍSTICA", marca: "AMBAR", min: 1 },
            "Acido Fluorídrico": { cat: "DENTÍSTICA", marca: "ALL PRIME", min: 6 },
            "Acido Fosfórico": { cat: "DENTÍSTICA", marca: "ALL PRIME", min: 20 },
            "Acrílica AltoPolimerizante 61": { cat: "DENTÍSTICA", marca: "DENCOR", min: 1 },
            "Acrílica AltoPolimerizante 62": { cat: "DENTÍSTICA", marca: "DENCOR", min: 1 },
            "Acrílica AltoPolimerizante 66": { cat: "DENTÍSTICA", marca: "DENCOR", min: 1 },
            "Acrílica AltoPolimerizante 69": { cat: "DENTÍSTICA", marca: "DENCOR", min: 1 },
            "Adesivo bond 2.1": { cat: "DENTÍSTICA", marca: "BIODINAMIC", min: 4 },
            "Adesivo MONO ADAPER SINGLE BOND 3 M": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 2 },
            "Banda Metálica 0,5": { cat: "DENTÍSTICA", marca: "PREVEN", min: 5 },
            "Banda Metálica 0,7": { cat: "DENTÍSTICA", marca: "PREVEN", min: 4 },
            "Bicarbonato": { cat: "DENTÍSTICA", marca: "MAQUIRA", min: 1 },
            "BROCA ZECRYA": { cat: "DENTÍSTICA", marca: "ALL PRIME", min: 6 },
            "Carbono para ajuste de oclusão": { cat: "DENTÍSTICA", marca: "MAQUIRA", min: 8 },
            "Cartão de Raio X": { cat: "DENTÍSTICA", marca: "PREVEN", min: 1 },
            "Cera 7": { cat: "DENTÍSTICA", marca: "LYSANDA", min: 2 },
            "Cera Utilidade Vermelha": { cat: "DENTÍSTICA", marca: "LYSANDA", min: 2 },
            "Cimento Resinoso DUAL": { cat: "DENTÍSTICA", marca: "VIGODENT", min: 3 },
            "CLAREAMENTO CASEIRO 16%": { cat: "DENTÍSTICA", marca: "FGM", min: 1 },
            "CLAREAMENTO CASEIRO 22%": { cat: "DENTÍSTICA", marca: "FGM", min: 4 },
            "Clareamento Consultório - HP": { cat: "DENTÍSTICA", marca: "FGM", min: 2 },
            "Cunha de madeira": { cat: "DENTÍSTICA", marca: "TDV", min: 2 },
            "RESINA AUTO ROSA": { cat: "DENTÍSTICA", marca: "DENCRILAY", min: 2 },
            "DISCO DE LIXA soft-lex pop-on": { cat: "DENTÍSTICA", marca: "3M", min: 1 },
            "Escova de Robson": { cat: "DENTÍSTICA", marca: "ALL PRIME", min: 30 },
            "Filme Adulto": { cat: "DENTÍSTICA", marca: "CARESTEA", min: 1 },
            "Filme Infantil": { cat: "DENTÍSTICA", marca: "CARESTEA", min: 1 },
            "Fio dental": { cat: "DENTÍSTICA", marca: "HILLO", min: 2 },
            "Flúor": { cat: "DENTÍSTICA", marca: "ALL PRIME", min: 2 },
            "Gel dessensibilizante": { cat: "DENTÍSTICA", marca: "FGM", min: 1 },
            "Hydcal- hidroxido de calcio": { cat: "DENTÍSTICA", marca: "MAQUIRA", min: 2 },
            "Ionomero de vidro po/liquido": { cat: "DENTÍSTICA", marca: "FGM", min: 2 },
            "Lixa Abrasiva de Metal": { cat: "DENTÍSTICA", marca: "INJECTA", min: 6 },
            "Tiras de lixa de poliester abrasiva": { cat: "DENTÍSTICA", marca: "Allprime", min: 4 },
            "Micro Brush regular": { cat: "DENTÍSTICA", marca: "ALL PRIME", min: 6 },
            "Obturador Provisório": { cat: "DENTÍSTICA", marca: "VILLEVIE", min: 4 },
            "Pasta de Zinco": { cat: "DENTÍSTICA", marca: "LYSANDA", min: 1 },
            "Pasta Profilática": { cat: "DENTÍSTICA", marca: "ALL PRIME", min: 4 },
            "PEDRA ASKANS": { cat: "DENTÍSTICA", marca: "AMERICAN BURS", min: 5 },
            "Pedra Pomes": { cat: "DENTÍSTICA", marca: "SSWHITE", min: 1 },
            "Pino de Fibra de Vidro 0.5": { cat: "DENTÍSTICA", marca: "SUPERPOST", min: 3 },
            "Resina Acrílica incolor": { cat: "DENTÍSTICA", marca: "DENCOR", min: 1 },
            "Resina Auto": { cat: "DENTÍSTICA", marca: "CLASSICO", min: 1 },
            "Resina Master Flow A3,5": { cat: "DENTÍSTICA", marca: "BIODINAMIC", min: 3 },
            "RESINA MASTER FLOW A1": { cat: "DENTÍSTICA", marca: "BIODINAMIC", min: 2 },
            "RESINA FORMA A3E": { cat: "DENTÍSTICA", marca: "ULTRADENT", min: 1 },
            "RESINA FORMA A1E": { cat: "DENTÍSTICA", marca: "ULTRADENT", min: 1 },
            "RESINA FORMA A2E": { cat: "DENTÍSTICA", marca: "ULTRADENT", min: 1 },
            "Resina Master Flow A2": { cat: "DENTÍSTICA", marca: "BIODINAMIC", min: 3 },
            "Resina Master Flow A3": { cat: "DENTÍSTICA", marca: "BIODINAMIC", min: 3 },
            "Resina Z 250- OA2": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 1 },
            "Resina Z100 - A1": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 2 },
            "Resina Z100 - A2": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 2 },
            "Resina Z100 - A3": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 2 },
            "Resina Z100 - A3.5": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 2 },
            "Resina Z100 - A4": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 2 },
            "Resina Z100 - B2": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 2 },
            "Resina Z250 - A1": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 2 },
            "Resina Z250 - A2": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 2 },
            "Resina Z250 - OA1": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 1 },
            "RESINA Z250 A3": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 1 },
            "Selante Yseal": { cat: "DENTÍSTICA", marca: "YLLER", min: 1 },
            "RESINA Z250 A 3,5": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 2 },
            "RESINA Z250 B1": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 1 },
            "RESINA Z250 OA2": { cat: "DENTÍSTICA", marca: "SOLVENTUM", min: 1 },
            "Silano": { cat: "DENTÍSTICA", marca: "VILLEVIE", min: 3 },
            "Silicone Optozil (ACTIVADOR)": { cat: "DENTÍSTICA", marca: "KULZER", min: 5 },
            "Silicone Optozil (DENSO)": { cat: "DENTÍSTICA", marca: "KULZER", min: 4 },
            "Silicone Optozil (LEVE)": { cat: "DENTÍSTICA", marca: "KULZER", min: 6 },
            "Tira de Poliéster transparente": { cat: "DENTÍSTICA", marca: "Kdent", min: 4 },
            "Top Dam (Barreira Gengival)": { cat: "DENTÍSTICA", marca: "ALLPLAN", min: 3 },
            "AGULHA DE IRRIGAÇÃO": { cat: "DIVERSOS", marca: "ALL PRIME", min: 1 },
            "LIQUIDO ACRILICO AUTOPOLIMERALIZAVEL TDV 500 ML": { cat: "DIVERSOS", marca: "TDV", min: 1 },
            "OLEO LUBRIFICANTE": { cat: "DIVERSOS", marca: "ALL PRIME", min: 1 },
            "ALGINATO ALVAGEL": { cat: "DIVERSOS", marca: "DENTSPLY", min: 6 },
            "ALGODAO ROLETE": { cat: "DIVERSOS", marca: "SSPLUS", min: 20 },
            "ANESTESICO SS WHITE LIDOSTESIN": { cat: "DIVERSOS", marca: "SS WHITE", min: 8 },
            "BABADOR": { cat: "DIVERSOS", marca: "ALL PRIME", min: 2 },
            "COLGADURAS": { cat: "DIVERSOS", marca: "GOLGRAN", min: 5 },
            "DESCARPACK 3L": { cat: "DIVERSOS", marca: "DESCARPACK", min: 2 },
            "DESCARPACK 7 L": { cat: "DIVERSOS", marca: "DESCARPACK", min: 1 },
            "GAZE HIDROFILICA": { cat: "DIVERSOS", marca: "ULTRACOTT", min: 3 },
            "GELINHOS": { cat: "DIVERSOS", marca: "-", min: 50 },
            "GESSO TIPO III AMARELO": { cat: "DIVERSOS", marca: "ASFER", min: 7 },
            "GESSO TIPO IV ROSA": { cat: "DIVERSOS", marca: "VIGODENT", min: 7 },
            "GRAU CIRURGICO 100X100": { cat: "DIVERSOS", marca: "ALLPRIME", min: 2 },
            "GRAU CIRURGICO 20X100": { cat: "DIVERSOS", marca: "ALLPRIME", min: 2 },
            "GRAU CIRURGICO 30X100": { cat: "DIVERSOS", marca: "ALLPRIME", min: 1 },
            "LUVAS COM PÓ P": { cat: "DIVERSOS", marca: "-", min: 40 },
            "MÁSCARA DESCARTÁVEL CAIXA COM 50": { cat: "DIVERSOS", marca: "SSPLUS", min: 5 },
            "MICRO BRUSH EXTRA FINO": { cat: "DIVERSOS", marca: "ALLPRIME", min: 3 },
            "RESINA ACRILICA POLIMERIZANTE JET PÓ ROSA 78G": { cat: "DIVERSOS", marca: "JET", min: 1 },
            "SERINGAS 10 ML": { cat: "DIVERSOS", marca: "DESCARPAK", min: 4 },
            "SERINGAS 20ML": { cat: "DIVERSOS", marca: "DESCARPAK", min: 4 },
            "SOFT REEMBASADOR": { cat: "DIVERSOS", marca: "TDV", min: 2 },
            "SUGADOR": { cat: "DIVERSOS", marca: "ALLPRIME", min: 25 },
            "TESTE BIOLOGICO - biological test": { cat: "DIVERSOS", marca: "2l", min: 2 },
            "TESTE QUIMICO- indicador quimico": { cat: "DIVERSOS", marca: "CLEAN UP", min: 4 },
            "TOUCA BRANCA": { cat: "DIVERSOS", marca: "DISCARPAK", min: 2 },
            "VASELINA SOLIDA": { cat: "DIVERSOS", marca: "RIOQUMICA", min: 1 },
            "CLOREXIDINA 0,12%": { cat: "ENDODONTIA", marca: "RIOQUIMICA", min: 5 },
            "CLOREXIDINA 2%": { cat: "ENDODONTIA", marca: "RIOQUIMICA", min: 1 },
            "CONE DE GUTAPERCHA 35.05(BASSI)": { cat: "ENDODONTIA", marca: "EASYBASSI", min: 1 },
            "CONE DE PAPEL 15-40": { cat: "ENDODONTIA", marca: "MKLIFE", min: 1 },
            "KIT ENDO IRRIGAÇÃO ENDO": { cat: "ENDODONTIA", marca: "ULTRADENT", min: 1 },
            "SERINGA IRRIGAÇÃO 5ML PACOTE COM 10": { cat: "ENDODONTIA", marca: "ULTRADENT", min: 1 },
            "HIDROXIDO DE CALCIO P.A": { cat: "ENDODONTIA", marca: "ULTRADENT", min: 1 },
            "CONE DE PAPEL 25": { cat: "ENDODONTIA", marca: "MKLIFE", min: 2 },
            "CONE DE PAPEL 45-80": { cat: "ENDODONTIA", marca: "MKLIFE", min: 2 },
            "CONE GUTAPERCHA 45- 80": { cat: "ENDODONTIA", marca: "BASSI", min: 1 },
            "CONE GUTAPERCHA F1": { cat: "ENDODONTIA", marca: "BASSI", min: 1 },
            "CONE GUTAPERCHA F2": { cat: "ENDODONTIA", marca: "BASSI", min: 1 },
            "CONE GUTAPERCHA F3 PROTAPER UNIVERSAL": { cat: "ENDODONTIA", marca: "PROTAPER", min: 1 },
            "EDTA": { cat: "ENDODONTIA", marca: "BIODINAMIC", min: 1 },
            "ENDOFIL PO": { cat: "ENDODONTIA", marca: "DENTSPLAY", min: 1 },
            "ENDOFIL LIQUIDO": { cat: "ENDODONTIA", marca: "DENTSPLAY", min: 1 },
            "EUCALIPTOL": { cat: "ENDODONTIA", marca: "BIODINAMIC", min: 1 },
            "FIO RETRATOR 00": { cat: "ENDODONTIA", marca: "BIODINAMIC", min: 2 },
            "FIO RETRATOR 000": { cat: "ENDODONTIA", marca: "BIODINAMIC", min: 2 },
            "FIXADOR": { cat: "ENDODONTIA", marca: "CARESTEA", min: 3 },
            "HIPOCLORITO DE SODIO 2,5%": { cat: "ENDODONTIA", marca: "ASFER", min: 1 },
            "HYDCAL": { cat: "ENDODONTIA", marca: "HYCAL", min: 3 },
            "LENCOL DE BORRACHA": { cat: "ENDODONTIA", marca: "MADEITEX", min: 2 },
            "LIMA ENDODONTICA 08 /25MM": { cat: "ENDODONTIA", marca: "ALPRIME", min: 2 },
            "LIMA ENDODONTICA 10 /25MM": { cat: "ENDODONTIA", marca: "ALPRIME", min: 2 },
            "LIMA ENDODONTICA 15 /25MM": { cat: "ENDODONTIA", marca: "ALPRIME", min: 2 },
            "LIMA ENDODONTICA 15-40/25mm": { cat: "ENDODONTIA", marca: "ALPRIME", min: 2 },
            "LIMA ENDODONTICA 15-40/31mm": { cat: "ENDODONTIA", marca: "ALPRIME", min: 1 },
            "LIMA ENDODONTICA 20 /25MM": { cat: "ENDODONTIA", marca: "ALPRIME", min: 2 },
            "LIMA ENDODONTICA 25/25 MM": { cat: "ENDODONTIA", marca: "ALPRIME", min: 2 },
            "LIMA ENDODONTICA 45-80/25mm": { cat: "ENDODONTIA", marca: "ALPRIME", min: 1 },
            "LIMA ENDODONTICA 45-80/31mm": { cat: "ENDODONTIA", marca: "ALPRIME", min: 1 },
            "LIMA K ENDODONTICA 25 MM": { cat: "ENDODONTIA", marca: "ALL PRIME", min: 2 },
            "REVELADOR": { cat: "ENDODONTIA", marca: "CARESTEA", min: 3 },
            "TESTE DE VITALIDADE - ENDOICE": { cat: "ENDODONTIA", marca: "MAQUIRA", min: 1 },
            "TRICRESOL": { cat: "ENDODONTIA", marca: "BIODINAMICA", min: 1 },
            "LIMA ENDODONTICA 25 /25MM": { cat: "ENDODONTIA", marca: "ALPRIME", min: 2 },
            "ULTRACAL": { cat: "ENDODONTIA", marca: "ULTRADENT", min: 1 },
            "ADESIVO ORTHOCEM": { cat: "ORTODONTIA", marca: "FGM", min: 4 },
            "ARCO INTRAORAL NITI TERMOATIVO 35º 14 SUP c/ 10 un": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ARCO INTRAORAL NITI TERMOATIVO 35º 16 INF c/ 10 un": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ARCO INTRAORAL NITI TERMOATIVO 35º 16 SUP c/ 10 un": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ARCO INTRAORAL NITI TERMOATIVO 35º 16X22 INF c/ 10 un": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ARCO INTRAORAL NITI TERMOATIVO 35º 18 INF c/ 10 un": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ARCO INTRAORAL NITI TERMOATIVO 35º 18X25 INF c/ 10 un": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ARCO INTRAORAL NITI TERMOATIVO 35º 20 INF c/ 10 un": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ARCO INTRAORAL AÇO INOXIDÁVEL 45/18 c/ 10": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "BOTÃO LINGUAL": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "BRAQUETE AUTO LIGADO": { cat: "ORTODONTIA", marca: "MORELLI", min: 4 },
            "BRAQUETE AUTO LIGADO ESTETICO": { cat: "ORTODONTIA", marca: "MORELLI", min: 0 },
            "BRAQUETE CONVENCIONAL 100CASOS MORELLI SLOT 22": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "BRAQUETE ESTÉTICO": { cat: "ORTODONTIA", marca: "MORELLI", min: 3 },
            "BRAQUETE MORELLI SLP 11": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "BRAQUETE MORELLI SLP 12": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "BRAQUETE MORELLI SLP 21": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "BRAQUETE MORELLI SLP 22": { cat: "ORTODONTIA", marca: "MORELLI", min: 3 },
            "CAIXA PARA APARELHO C/10": { cat: "ORTODONTIA", marca: "SSPLUS", min: 2 },
            "CERA ORTODONTICA": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "ELASTICO BENGALINA BRANCO RENDA": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA AMARELO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA AZUL": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA AZUL BEBÊ": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA AZUL CRISTAL": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "ELASTICO BENGALINA AZUL MARINHO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA CINZA": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA CRISTAL": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA LARANJA CRISTAL": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA LILÁS": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA PEAR BLUES": { cat: "ORTODONTIA", marca: "MORELLI", min: 4 },
            "ELASTICO BENGALINA PINK CRISTAL": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA PRATEADO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA PRETO": { cat: "ORTODONTIA", marca: "MORELLI", min: 3 },
            "ELASTICO BENGALINA ROSA": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA ROSA BEBÊ": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA ROSA PEROLA": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA ROXO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA UVA CRISTAL": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA VERDE CRISTAL": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA VERDE LIMÃO CRISTAL": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA VERDE MAR": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA VERDE MUSGO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA VERDE PEROLA": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA VERMELHO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA VERMELHO CRISTAL": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINA VINHO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO BENGALINHA AZUL MARINHO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE AMARELO CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE AMARELO MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE AZUL BEBE CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE AZUL BEBE MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE AZUL CRISTAL CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE AZUL CRISTAL MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE AZUL CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE AZUL MARINHO CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE AZUL MARINHO MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE AZUL MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE BRANCO RENDA CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE BRANCO RENDA MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE CINZA CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE CINZA MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE CRISTAL CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE CRISTAL MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE LARANJA CRISTAL CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE LARANJA CRISTAL MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE LILAS CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "ELÁSTICO CORRENTE LILAS MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE MARFIM CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 0 },
            "ELÁSTICO CORRENTE MARFIM MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 0 },
            "ELÁSTICO CORRENTE PEARL BLUE CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE PEARL BLUE MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE PINK CRISTAL CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE PINK CRISTAL MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE PRATEADO CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE PRATEADO MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE PRETO CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "ELÁSTICO CORRENTE PRETO MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "ELÁSTICO CORRENTE ROSA BEBE CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE ROSA BEBE MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE ROSA PEROLA CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE ROSA PEROLA MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE ROXO CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE ROXO MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERDE CRISTAL CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERDE CRISTAL MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERDE LIMAO CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERDE LIMAO MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERDE MAR CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERDE MAR MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERDE MUSGO CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERDE MUSGO MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERDE PEROLA CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERDE PEROLA MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERMELHO CRISTAL CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERMELHO CRISTAL MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERMELHO CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VERMELHO MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VINHO CURTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELÁSTICO CORRENTE VINHO MEDIO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO INTRAORAL MÉDIO 1/8": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "ELASTICO INTRAORAL MEDIO 3/16": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO INTRAORAL PESADO 1/8": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ELASTICO INTRAORAL PESADO 3/16": { cat: "ORTODONTIA", marca: "MORELLI", min: 3 },
            "FIO AÇO 12 INFERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 12 SUPERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 14 INFERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 14 SUPERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 16 INFERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 16 SUPERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 16X16 INFERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 16X16 SUPERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 16X22 INFERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 16X22 SUPERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 17X25 SUPERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 17X25 INFERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 18 INFERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 18 SUPERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 18X25 INFERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 18X25 SUPERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 19X25 INFERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 19X25 SUPERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 20 INFERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO AÇO 20 SUPERIOR C/50 UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "FIO PRE-CONTORNADO 12 INF C/10 UND": { cat: "ORTODONTIA", marca: "ORTHOMETRIC", min: 2 },
            "FIO PRE-CONTORNADO 16 INF C/10 UND": { cat: "ORTODONTIA", marca: "ORTHOMETRIC", min: 2 },
            "FIO DE AMARILHO 0,25 MM": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO DE AMARILHO 0,30 MM": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO DE AMARILHO 0,35 MM": { cat: "ORTODONTIA", marca: "MORELLI", min: 0 },
            "FIO DE AMARILHO 0,40 MM": { cat: "ORTODONTIA", marca: "MORELLI", min: 0 },
            "FIO DE AMARILHO 0,45 MM": { cat: "ORTODONTIA", marca: "MORELLI", min: 0 },
            "FIO NITI 12 INFERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 12 SUPERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 14 INFERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 14 SUPERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 16 INFERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 16 SUPERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 16X16 SUPERIOR 50UN": { cat: "ORTODONTIA", marca: "ORTHOMETRIC", min: 1 },
            "FIO NITI 16X16 INFERIOR 50UN": { cat: "ORTODONTIA", marca: "ORTHOMETRIC", min: 1 },
            "FIO NITI 16X22 INFERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 16X22 SUPERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 17X25 INFERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 17X25 SUPERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 18 INFERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 18 SUPERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 18X25 INFERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 19X25 SUPERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 18X25 INFERIOR 100UN": { cat: "ORTODONTIA", marca: "ORTHOMETRIC", min: 1 },
            "FIO NITI 20 INFERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "FIO NITI 20 SUPERIOR 100UN": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "GANCHO PONTA BOLA RETO LONGO": { cat: "ORTODONTIA", marca: "MORELLI", min: 5 },
            "MINI ESPORÃO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "MOLA ABERTA": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "ORTOBITE AZUL": { cat: "ORTODONTIA", marca: "MORELLI", min: 2 },
            "ORTOBITE ROSA PINK": { cat: "ORTODONTIA", marca: "MAQUIRA", min: 2 },
            "SAQUINHO PARA ELASTICO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "STOP ABERTO": { cat: "ORTODONTIA", marca: "MORELLI", min: 1 },
            "TUBO MORELLI COLAGEM SIMPLES 16/17": { cat: "ORTODONTIA", marca: "MORELLI", min: 5 },
            "TUBO MORELLI COLAGEM SIMPLES 26/27": { cat: "ORTODONTIA", marca: "MORELLI", min: 5 },
            "TUBO MORELLI COLAGEM SIMPLES 36/37": { cat: "ORTODONTIA", marca: "MORELLI", min: 5 },
            "TUBO MORELLI COLAGEM SIMPLES 46/47": { cat: "ORTODONTIA", marca: "MORELLI", min: 5 }
        };

        // --- FUNÇÕES DE NAVEGAÇÃO ---
        window.showLoading = (show) => { document.getElementById('loading-overlay').style.display = show ? 'flex' : 'none'; }
        
        window.showAlert = (msg) => {
            const box = document.getElementById('alert-box');
            document.getElementById('alert-message').textContent = msg;
            box.classList.remove('hidden');
            setTimeout(() => box.classList.add('hidden'), 5000); // 5 segundos
        }

        window.goToPage = (pageId) => {
            document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
            const page = document.getElementById(pageId);
            if(page) page.style.display = pageId.includes('select-filial') || pageId.includes('login') ? 'flex' : 'block';
            window.scrollTo(0,0);
            if(window.lucide) lucide.createIcons();
            if(pageId === 'page-manage-stock') renderStockTable();
            if(pageId === 'page-order-form') renderOrderTable();
        }

        // --- FIREBASE ---
        
        // 1. Carregar Dados
        async function loadFilialData() {
            showLoading(true);
            try {
                const docRef = doc(db, "estoques", selectedFilial);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    filialInventory = docSnap.data().items;
                } else {
                    filialInventory = {};
                    for (const [desc, item] of Object.entries(INITIAL_CATALOG)) {
                        filialInventory[desc] = {
                            descricao: desc,
                            categoria: item.cat,
                            marca: item.marca,
                            minimo: item.min,
                            estoque: 0
                        };
                    }
                    await setDoc(doc(db, "estoques", selectedFilial), { items: filialInventory });
                }
            } catch (error) {
                console.error(error);
                showAlert("Erro: " + error.message);
            }
            showLoading(false);
        }

        // 2. Salvar Estoque
        window.saveStock = async () => {
            showLoading(true);
            try {
                await setDoc(doc(db, "estoques", selectedFilial), { items: filialInventory });
                showAlert("Salvo com sucesso!");
                goToPage('page-menu');
            } catch (error) {
                showAlert("Erro ao salvar: " + error.message);
            }
            showLoading(false);
        }

        // 3. Enviar Pedido
        window.submitOrder = async () => {
            if(!selectedFilial) {
                showAlert("Erro crítico: Nenhuma filial selecionada. Faça login novamente.");
                return;
            }
            if(Object.keys(currentOrder).length === 0 && !currentExtraItems) return showAlert("Pedido vazio!");

            showLoading(true);
            const order = {
                filial: selectedFilial,
                createdAt: new Date().toISOString(),
                items: currentOrder,
                extraItems: currentExtraItems,
                status: 'Pendente',
                timestamp: Date.now()
            };
            
            try {
                await addDoc(collection(db, "pedidos"), order);
                window.currentOrder = {};
                window.currentExtraItems = "";
                document.getElementById('extra-items-textarea').value = "";
                showAlert("Pedido enviado com sucesso!");
                await renderClinicHistory(); 
            } catch (error) {
                console.error("Erro no envio:", error);
                if(error.message.includes("index")) {
                    alert("ATENÇÃO: É necessário criar um índice no Firebase. Abra o console do navegador (F12) e clique no link fornecido pelo erro.");
                }
                showAlert("Erro no envio: " + error.message);
            } finally {
                showLoading(false);
            }
        }

        // 4. Histórico da Clínica
        window.renderClinicHistory = async () => {
            showLoading(true);
            const list = document.getElementById('clinic-history-list');
            list.innerHTML = '';
            
            try {
                const q = query(collection(db, "pedidos"), where("filial", "==", selectedFilial), orderBy("timestamp", "desc"));
                const querySnapshot = await getDocs(q);
                
                if(querySnapshot.empty) {
                    list.innerHTML = '<p class="text-center text-gray-400 py-8">Nenhum pedido encontrado.</p>';
                }

                querySnapshot.forEach((doc) => {
                    const order = doc.data();
                    const div = document.createElement('div');
                    
                    let statusClass = "bg-yellow-100 text-yellow-800 border-yellow-200";
                    let icon = "clock";
                    if(order.status === 'Aprovado') { statusClass = "bg-green-100 text-green-800 border-green-200"; icon = "check-circle"; }
                    if(order.status === 'Rejeitado') { statusClass = "bg-red-100 text-red-800 border-red-200"; icon = "x-circle"; }

                    div.className = "bg-white p-4 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow";
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <p class="text-sm text-gray-500">${new Date(order.createdAt).toLocaleDateString()} às ${new Date(order.createdAt).toLocaleTimeString().slice(0,5)}</p>
                                <span class="inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-bold uppercase mt-1 ${statusClass}">
                                    <i data-lucide="${icon}" class="w-3 h-3"></i> ${order.status}
                                </span>
                            </div>
                            <button onclick="printOrderFromHistory('${doc.id}')" class="text-gray-400 hover:text-blue-600"><i data-lucide="printer" class="w-5 h-5"></i></button>
                        </div>
                        <div class="text-sm text-gray-600 border-t pt-2">
                             ${Object.entries(order.items).map(([k,v]) => `<span class="inline-block bg-gray-50 px-2 py-1 rounded mr-1 mb-1 border border-gray-100 text-xs">${v}x ${k}</span>`).join('')}
                             ${order.extraItems ? `<p class="mt-2 text-xs italic text-gray-500 bg-yellow-50 p-2 rounded">Obs: ${order.extraItems}</p>` : ''}
                        </div>
                    `;
                    list.appendChild(div);
                });
                if(window.lucide) lucide.createIcons();
                goToPage('page-history-clinic');
                window.tempHistory = querySnapshot.docs.map(d => ({id: d.id, data: d.data()}));
            } catch (error) {
                console.error(error);
                if(error.message.includes("index")) {
                     showAlert("ERRO DE ÍNDICE: Abra o console (F12) e clique no link para criar o índice no Firebase.");
                } else {
                     showAlert("Erro ao carregar histórico: " + error.message);
                }
            }
            showLoading(false);
        }

        window.printOrderFromHistory = (id) => {
            const orderObj = window.tempHistory.find(o => o.id === id);
            if(orderObj) printOrder(orderObj.data.items, orderObj.data.extraItems, orderObj.data.createdAt);
        }

        // 5. Admin Panel
        window.loadAdminPanel = async () => {
            showLoading(true);
            const container = document.getElementById('admin-list-container');
            container.innerHTML = '';
            let hasOrders = false;

            try {
                const q = query(collection(db, "pedidos"), where("status", "==", "Pendente"), orderBy("timestamp", "desc"));
                const querySnapshot = await getDocs(q);

                querySnapshot.forEach((doc) => {
                    hasOrders = true;
                    const order = doc.data();
                    const orderId = doc.id;

                    const div = document.createElement('div');
                    div.className = "bg-white p-6 rounded-xl shadow-md border-l-4 border-yellow-400";
                    div.innerHTML = `
                        <div class="flex flex-col md:flex-row justify-between mb-4 border-b pb-2">
                            <h3 class="font-bold text-lg text-blue-800">${order.filial}</h3>
                            <span class="text-gray-500 text-sm">${new Date(order.createdAt).toLocaleString()}</span>
                        </div>
                        <div class="mb-4">
                            <ul class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-700">
                                ${Object.entries(order.items).map(([k,v]) => `<li class="flex justify-between bg-gray-50 p-2 rounded"><span>${k}</span><span class="font-bold">${v}</span></li>`).join('')}
                            </ul>
                            ${order.extraItems ? `<div class="mt-3 p-3 bg-yellow-50 rounded text-sm italic text-gray-600 border border-yellow-100"><strong>Obs:</strong> ${order.extraItems}</div>` : ''}
                        </div>
                        <div class="flex gap-3 pt-2">
                            <button onclick="updateStatus('${orderId}', 'Aprovado')" class="flex-1 bg-green-100 text-green-700 px-4 py-3 rounded-lg font-bold hover:bg-green-200 transition-colors flex justify-center gap-2"><i data-lucide="check" class="w-5 h-5"></i> Aprovar</button>
                            <button onclick="updateStatus('${orderId}', 'Rejeitado')" class="flex-1 bg-red-100 text-red-700 px-4 py-3 rounded-lg font-bold hover:bg-red-200 transition-colors flex justify-center gap-2"><i data-lucide="x" class="w-5 h-5"></i> Rejeitar</button>
                        </div>
                    `;
                    container.appendChild(div);
                });
                if(window.lucide) lucide.createIcons();
            } catch (error) {
                showAlert("Erro ao carregar pedidos: " + error.message);
            }

            document.getElementById('no-pending-orders').style.display = hasOrders ? 'none' : 'block';
            showLoading(false);
        }

        window.updateStatus = async (orderId, newStatus) => {
            showLoading(true);
            try {
                await updateDoc(doc(db, "pedidos", orderId), { status: newStatus });
                showAlert(`Pedido ${newStatus}!`);
                loadAdminPanel();
            } catch (error) {
                showAlert("Erro ao atualizar status: " + error.message);
            }
            showLoading(false);
        }
        
        window.refreshAdminPanel = () => { loadAdminPanel(); }

        // --- UI AUXILIAR ---
        function groupProducts(list) {
            const grouped = {};
            list.forEach(p => {
                if(!grouped[p.categoria]) grouped[p.categoria] = [];
                grouped[p.categoria].push(p);
            });
            return grouped;
        }

        // --- FUNÇÃO PARA DESTRAVAR MÍNIMOS ---
        window.unlockMinimums = () => {
            const pwd = prompt("Digite a Senha Mestra para alterar os mínimos:");
            if (pwd === MASTER_PASSWORD) {
                minUnlocked = true;
                showAlert("Mínimos desbloqueados!");
                renderStockTable(); // Atualiza a tabela para habilitar os inputs
                
                // Muda a cor do botão para mostrar que está desbloqueado
                const btn = document.getElementById('btn-unlock');
                btn.classList.remove('bg-gray-200', 'text-gray-600');
                btn.classList.add('bg-green-200', 'text-green-800');
            } else if (pwd !== null) {
                showAlert("Senha incorreta!");
            }
        }

        function renderStockTable() {
            const tbody = document.getElementById('stock-table-body');
            tbody.innerHTML = '';
            const list = Object.values(filialInventory).sort((a,b) => a.descricao.localeCompare(b.descricao));
            const grouped = groupProducts(list);

            for (const [cat, prods] of Object.entries(grouped).sort()) {
                // CORRIGIDO: Removido 'sticky top-10' para evitar sobreposição
                tbody.innerHTML += `<tr class="bg-gray-100"><td colspan="4" class="px-4 py-2 font-bold text-xs uppercase text-gray-700 tracking-wider">${cat}</td></tr>`;
                prods.forEach(p => {
                    // SE minUnlocked for falso, adiciona 'disabled' e muda a cor
                    const disabledAttr = minUnlocked ? '' : 'disabled';
                    const bgClass = minUnlocked ? 'bg-white' : 'bg-gray-100 text-gray-400 cursor-not-allowed';

                    tbody.innerHTML += `
                        <tr class="border-b hover:bg-blue-50 transition-colors">
                            <td class="px-4 py-3 align-middle">
                                <div class="text-sm font-medium text-gray-800 leading-tight">${p.descricao}</div>
                                <div class="text-[10px] text-gray-400 mt-0.5">${p.marca}</div>
                            </td>
                            <td class="text-center align-middle p-1">
                                <input type="number" ${disabledAttr} class="w-14 h-8 border rounded text-center text-sm outline-none focus:border-blue-500 ${bgClass}" value="${p.minimo}" onchange="updateLocalProduct('${p.descricao}', 'minimo', this.value)">
                            </td>
                            <td class="text-center align-middle p-1">
                                <input type="number" class="w-14 h-8 border rounded text-center text-sm font-bold text-blue-600 outline-none focus:border-blue-500 bg-white" value="${p.estoque}" onchange="updateLocalProduct('${p.descricao}', 'estoque', this.value)">
                            </td>
                            <td class="text-center align-middle"><button class="text-red-300 hover:text-red-600 p-2" onclick="removeProduct('${p.descricao}')"><i data-lucide="trash-2" class="w-4 h-4"></i></button></td>
                        </tr>
                    `;
                });
            }
            if(window.lucide) lucide.createIcons();
        }

        window.updateLocalProduct = (desc, field, val) => {
            if(filialInventory[desc]) filialInventory[desc][field] = parseInt(val) || 0;
        }

        window.removeProduct = (desc) => {
            if(confirm("Remover este produto da lista?")) {
                delete filialInventory[desc];
                renderStockTable();
            }
        }

        function renderOrderTable() {
            const tbody = document.getElementById('order-table-body');
            tbody.innerHTML = '';
            const list = Object.values(filialInventory).sort((a,b) => a.descricao.localeCompare(b.descricao));
            const grouped = groupProducts(list);

            for (const [cat, prods] of Object.entries(grouped).sort()) {
                // CORRIGIDO: Removido 'sticky top-10' para evitar sobreposição
                tbody.innerHTML += `<tr class="bg-gray-100"><td colspan="5" class="px-4 py-2 font-bold text-xs uppercase text-gray-700 tracking-wider">${cat}</td></tr>`;
                prods.forEach(p => {
                    const sug = Math.max(0, p.minimo - p.estoque);
                    const highlight = sug > 0 ? "bg-red-50" : "";
                    
                    tbody.innerHTML += `
                        <tr class="border-b hover:bg-blue-50 transition-colors ${highlight}">
                            <td class="px-4 py-3 align-middle">
                                <div class="text-sm font-medium text-gray-800 leading-tight">${p.descricao}</div>
                                <div class="text-[10px] text-gray-400 mt-0.5">${p.marca}</div>
                            </td>
                            <td class="text-center text-xs text-gray-400">${p.minimo}</td>
                            <td class="text-center text-xs text-gray-400">${p.estoque}</td>
                            <td class="text-center font-bold text-sm ${sug>0?'text-red-600':'text-gray-300'}">${sug}</td>
                            <td class="text-center align-middle p-1"><input type="number" class="w-16 h-9 border rounded-lg text-center text-sm order-qtd outline-none focus:ring-2 focus:ring-blue-500 ${sug>0?'bg-white font-bold border-red-200':''}" data-desc="${p.descricao}" value="${sug}"></td>
                        </tr>
                    `;
                });
            }
        }

        window.reviewOrder = () => {
            currentOrder = {};
            document.querySelectorAll('.order-qtd').forEach(el => {
                const qtd = parseInt(el.value);
                if(qtd > 0) currentOrder[el.dataset.desc] = qtd;
            });
            currentExtraItems = document.getElementById('extra-items-textarea').value;
            
            const div = document.getElementById('review-summary-container');
            if(Object.keys(currentOrder).length === 0 && !currentExtraItems) {
                div.innerHTML = '<p class="text-gray-500 italic text-center py-4">Nenhum item selecionado.</p>';
            } else {
                let html = '<ul class="divide-y divide-gray-100">';
                for(const [k,v] of Object.entries(currentOrder)) {
                    html += `<li class="flex justify-between py-2 text-sm"><span>${k}</span><span class="font-bold text-blue-700">${v}</span></li>`;
                }
                html += '</ul>';
                if(currentExtraItems) html += `<div class="mt-4 p-3 bg-yellow-50 rounded text-sm italic border border-yellow-100"><strong class="block text-yellow-800 not-italic mb-1">Extras:</strong>${currentExtraItems}</div>`;
                div.innerHTML = html;
            }
            goToPage('page-review-order');
        }

        window.filterTable = (input, tbody) => {
            const term = document.getElementById(input).value.toLowerCase();
            const rows = document.getElementById(tbody).querySelectorAll('tr');
            rows.forEach(r => {
                if(!r.cells[0]) return; 
                const txt = r.innerText.toLowerCase();
                r.style.display = txt.includes(term) ? '' : 'none';
            });
        }
        
        // --- LOGINS E SENHAS ---
        window.goToLogin = (f) => { 
            selectedFilial = f;
            localStorage.setItem('lastFilial', f); 
            document.getElementById('login-filial-name').innerText = f; 
            document.getElementById('filial-password').value = '';
            goToPage('page-login'); 
            setTimeout(() => document.getElementById('filial-password').focus(), 100);
        }

        window.handleFilialLogin = () => { 
            if(document.getElementById('filial-password').value === FILIAL_PASSWORDS[selectedFilial]) { 
                loadFilialData(); 
                document.getElementById('menu-filial-name').innerText = selectedFilial; 
                goToPage('page-menu'); 
            } else { 
                showAlert("Senha incorreta!"); 
            } 
        }

        window.goToAdminLogin = () => {
            document.getElementById('admin-password').value = '';
            goToPage('page-admin-login'); 
            setTimeout(() => document.getElementById('admin-password').focus(), 100);
        }

        window.handleAdminLogin = () => { 
            if(document.getElementById('admin-password').value === ADMIN_PASSWORD) { 
                loadAdminPanel(); 
                goToPage('page-admin-panel'); 
            } else { 
                showAlert("Senha incorreta!"); 
            } 
        }
        
        window.logout = () => {
            window.selectedFilial = null;
            // Bloqueia de novo ao sair
            minUnlocked = false; 
            const btn = document.getElementById('btn-unlock');
            if(btn) {
                btn.classList.add('bg-gray-200', 'text-gray-600');
                btn.classList.remove('bg-green-200', 'text-green-800');
            }

            localStorage.removeItem('lastFilial');
            document.getElementById('filial-password').value = '';
            document.getElementById('admin-password').value = '';
            goToPage('page-select-filial');
        }
        
        document.getElementById('filial-password').addEventListener('keyup', (e) => {
            if(e.key === 'Enter') handleFilialLogin();
        });
        document.getElementById('admin-password').addEventListener('keyup', (e) => {
            if(e.key === 'Enter') handleAdminLogin();
        });

        // --- IMPRESSÃO CLEAN ---
        window.printOrder = (items, extras, date = null) => {
            const area = document.getElementById('print-area');
            const dateStr = date ? new Date(date).toLocaleString() : new Date().toLocaleString();
            
            let html = `
                <div class="print-header">
                    <div class="print-title">Pedido de Materiais</div>
                    <div class="print-meta">${selectedFilial} - ${dateStr}</div>
                </div>
                
                <div class="print-grid">
            `;
            
            for(const [k,v] of Object.entries(items)) {
                html += `<div class="print-item"><span>${k}</span><span>${v}</span></div>`;
            }
            html += `</div>`; 

            if(extras) {
                html += `<div class="print-extras"><strong>Observações:</strong><br>${extras}</div>`;
            }
            
            area.innerHTML = html;
            window.print();
        }

        // --- ADICIONAR PRODUTO ---
        window.openAddProductModal = () => { document.getElementById('modal-add-product').style.display = 'flex'; }
        window.closeAddProductModal = () => { document.getElementById('modal-add-product').style.display = 'none'; }
        window.addNewProduct = () => {
            const desc = document.getElementById('new-prod-desc').value;
            if(!desc) return;
            filialInventory[desc] = {
                descricao: desc,
                categoria: document.getElementById('new-prod-cat').value || 'DIVERSOS',
                marca: document.getElementById('new-prod-marca').value || '',
                minimo: 0,
                estoque: 0
            };
            saveStock();
            closeAddProductModal();
            renderStockTable();
        }

        // Inicializa
        goToPage('page-select-filial');

    </script>
</body>
</html>
